"use strict";(()=>{var e={};e.id=385,e.ids=[385,888,660],e.modules={353:(e,a,t)=>{t.d(a,{BT:()=>AnalyticsDashboard});var s=t(6689),r=t(3655),l=t(997);let RevenueChart=({data:e})=>(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[l.jsx("h3",{className:"text-xl font-bold mb-4",children:"Revenue Trend"}),l.jsx(r.ResponsiveContainer,{width:"100%",height:300,children:(0,l.jsxs)(r.LineChart,{data:e,children:[l.jsx(r.CartesianGrid,{strokeDasharray:"3 3"}),l.jsx(r.XAxis,{dataKey:"date"}),l.jsx(r.YAxis,{}),l.jsx(r.Tooltip,{formatter:e=>`R$ ${e.toLocaleString("pt-BR")}`}),l.jsx(r.Legend,{}),l.jsx(r.Line,{type:"monotone",dataKey:"revenue",stroke:"#3b82f6",strokeWidth:2,name:"Receita"}),l.jsx(r.Line,{type:"monotone",dataKey:"expenses",stroke:"#ef4444",strokeWidth:2,name:"Despesas"}),l.jsx(r.Line,{type:"monotone",dataKey:"profit",stroke:"#10b981",strokeWidth:2,name:"Lucro"})]})})]}),BookingTrendsChart=({data:e})=>(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[l.jsx("h3",{className:"text-xl font-bold mb-4",children:"Booking Trends"}),l.jsx(r.ResponsiveContainer,{width:"100%",height:300,children:(0,l.jsxs)(r.BarChart,{data:e,children:[l.jsx(r.CartesianGrid,{strokeDasharray:"3 3"}),l.jsx(r.XAxis,{dataKey:"date"}),l.jsx(r.YAxis,{}),l.jsx(r.Tooltip,{}),l.jsx(r.Legend,{}),l.jsx(r.Bar,{dataKey:"bookings",fill:"#3b82f6",name:"Agendamentos"}),l.jsx(r.Bar,{dataKey:"completed",fill:"#10b981",name:"Completados"}),l.jsx(r.Bar,{dataKey:"cancelled",fill:"#ef4444",name:"Cancelados"})]})})]}),ConversionFunnelChart=({data:e})=>{let a=[{name:"Visitantes",value:e.visitors||1e3},{name:"Clientes Ativos",value:e.activeCustomers||750},{name:"Com Agendamentos",value:e.bookingsCreated||500},{name:"Pagamentos Processados",value:e.paymentsProcessed||400},{name:"Avalia\xe7\xf5es Deixadas",value:e.reviewsLeft||200}];return(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[l.jsx("h3",{className:"text-xl font-bold mb-4",children:"Funnel de Convers\xe3o"}),l.jsx(r.ResponsiveContainer,{width:"100%",height:300,children:(0,l.jsxs)(r.FunnelChart,{children:[l.jsx(r.Tooltip,{formatter:e=>`${e} usu\xe1rios`}),l.jsx(r.Funnel,{data:a,dataKey:"value",stroke:"#3b82f6",fill:"#3b82f6",children:a.map((e,a)=>l.jsx(r.Cell,{fill:["#3b82f6","#60a5fa","#93c5fd","#dbeafe","#eff6ff"][a]},`cell-${a}`))})]})}),l.jsx("div",{className:"mt-4 text-sm text-gray-600",children:a.map((e,t)=>(0,l.jsxs)("div",{className:"flex justify-between",children:[l.jsx("span",{children:e.name}),l.jsx("span",{className:"font-bold",children:e.value}),t>0&&(0,l.jsxs)("span",{className:"text-blue-600",children:[(e.value/a[0].value*100).toFixed(1),"%"]})]},t))})]})},CLVDistributionChart=({data:e})=>(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[l.jsx("h3",{className:"text-xl font-bold mb-4",children:"Customer Lifetime Value"}),l.jsx(r.ResponsiveContainer,{width:"100%",height:300,children:(0,l.jsxs)(r.ScatterChart,{margin:{top:20,right:20,bottom:20,left:20},children:[l.jsx(r.CartesianGrid,{strokeDasharray:"3 3"}),l.jsx(r.XAxis,{dataKey:"bookings",name:"Agendamentos"}),l.jsx(r.YAxis,{dataKey:"ltv",name:"LTV (R$)"}),l.jsx(r.Tooltip,{cursor:{strokeDasharray:"3 3"}}),l.jsx(r.Scatter,{name:"Clientes",data:e,fill:"#3b82f6"})]})})]}),CustomerSegmentationChart=({data:e})=>{let a=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"];return(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[l.jsx("h3",{className:"text-xl font-bold mb-4",children:"Customer Segmentation"}),l.jsx(r.ResponsiveContainer,{width:"100%",height:300,children:(0,l.jsxs)(r.PieChart,{children:[l.jsx(r.Pie,{data:e,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:a})=>`${e}: ${a}`,outerRadius:100,fill:"#3b82f6",dataKey:"value",children:e.map((e,t)=>l.jsx(r.Cell,{fill:a[t%a.length]},`cell-${t}`))}),l.jsx(r.Tooltip,{formatter:e=>`${e} clientes`})]})}),l.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:e.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center",children:[l.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:a[t%a.length]}}),(0,l.jsxs)("span",{children:[e.name,": ",e.value]})]},t))})]})},ChurnRiskHeatmap=({data:e})=>(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[l.jsx("h3",{className:"text-xl font-bold mb-4",children:"Churn Risk Analysis"}),l.jsx("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full text-sm",children:[l.jsx("thead",{className:"bg-gray-100",children:(0,l.jsxs)("tr",{children:[l.jsx("th",{className:"p-2 text-left",children:"Metric"}),l.jsx("th",{className:"p-2 text-center",children:"Status"}),l.jsx("th",{className:"p-2 text-right",children:"Value"}),l.jsx("th",{className:"p-2 text-left",children:"Risk"})]})}),l.jsx("tbody",{children:e.map((e,a)=>{let t="bg-green-100",s="Baixo";return e.risk>70?(t="bg-red-100",s="Alto"):e.risk>40&&(t="bg-yellow-100",s="M\xe9dio"),(0,l.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[l.jsx("td",{className:"p-2",children:e.metric}),l.jsx("td",{className:"p-2 text-center",children:l.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:l.jsx("div",{className:`h-2 rounded-full ${e.risk>70?"bg-red-500":e.risk>40?"bg-yellow-500":"bg-green-500"}`,style:{width:`${e.risk}%`}})})}),l.jsx("td",{className:"p-2 text-right font-bold",children:e.value}),l.jsx("td",{className:`p-2 font-bold ${t}`,children:s})]},a)})})]})})]}),AnalyticsDashboard=({data:e,loading:a,error:t})=>{let[r,n]=(0,s.useState)("30days"),[i,o]=(0,s.useState)(["revenue","bookings","conversion"]);return a?l.jsx("div",{className:"p-8 text-center",children:"Carregando analytics..."}):t?(0,l.jsxs)("div",{className:"p-8 text-center text-red-600",children:["Erro ao carregar dados: ",t]}):(0,l.jsxs)("div",{className:"space-y-6",children:[l.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[l.jsx("h2",{className:"text-2xl font-bold",children:"Analytics Dashboard"}),(0,l.jsxs)("select",{value:r,onChange:e=>n(e.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[l.jsx("option",{value:"7days",children:"\xdaltimos 7 dias"}),l.jsx("option",{value:"30days",children:"\xdaltimos 30 dias"}),l.jsx("option",{value:"90days",children:"\xdaltimos 90 dias"}),l.jsx("option",{value:"1year",children:"\xdaltimo ano"}),l.jsx("option",{value:"custom",children:"Custom"})]})]})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[l.jsx("h4",{className:"text-gray-600 text-sm",children:"Total Revenue"}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",(e.totalRevenue||0).toLocaleString("pt-BR")]}),(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.revenueGrowth||0,"% vs period anterior"]})]}),(0,l.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[l.jsx("h4",{className:"text-gray-600 text-sm",children:"Total Bookings"}),l.jsx("p",{className:"text-2xl font-bold text-green-600",children:e.totalBookings||0}),(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.bookingGrowth||0,"% vs period anterior"]})]}),(0,l.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[l.jsx("h4",{className:"text-gray-600 text-sm",children:"Active Users"}),l.jsx("p",{className:"text-2xl font-bold text-purple-600",children:e.activeUsers||0}),(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.userGrowth||0,"% vs period anterior"]})]}),(0,l.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg",children:[l.jsx("h4",{className:"text-gray-600 text-sm",children:"Conversion Rate"}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-orange-600",children:[(e.conversionRate||0).toFixed(1),"%"]}),(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.conversionGrowth||0,"% vs period anterior"]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsx(RevenueChart,{data:e.revenueData||[]}),l.jsx(BookingTrendsChart,{data:e.bookingData||[]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsx(ConversionFunnelChart,{data:e.funnelData||{}}),l.jsx(CustomerSegmentationChart,{data:e.segmentationData||[]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsx(CLVDistributionChart,{data:e.clvData||[]}),l.jsx(ChurnRiskHeatmap,{data:e.churnData||[]})]}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[l.jsx("h3",{className:"text-lg font-bold mb-4",children:"Customize Dashboard"}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:["revenue","bookings","conversion","ltv","churn","engagement","payments","reviews"].map(e=>(0,l.jsxs)("label",{className:"flex items-center space-x-2",children:[l.jsx("input",{type:"checkbox",defaultChecked:i.includes(e),onChange:a=>{a.target.checked?o([...i,e]):o(i.filter(a=>a!==e))},className:"w-4 h-4"}),l.jsx("span",{className:"text-sm capitalize",children:e})]},e))})]})]})}},7077:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.d(a,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var r=t(6689),l=t(9648),n=e([l]);l=(n.then?(await n)():n)[0];let i=process.env.REACT_APP_API_URL||"http://localhost:5000/api",__WEBPACK_DEFAULT_EXPORT__=(e="30days")=>{let[a,t]=(0,r.useState)(null),[s,n]=(0,r.useState)(!0),[o,d]=(0,r.useState)(null),c=(0,r.useCallback)(async()=>{try{n(!0),d(null);let a=localStorage.getItem("token"),s={headers:{Authorization:`Bearer ${a}`}},r=await l.default.get(`${i}/analytics/dashboard?dateRange=${e}`,s);t(r.data.data)}catch(e){d(e.response?.data?.error||"Failed to fetch analytics"),console.error("Analytics error:",e)}finally{n(!1)}},[e]);(0,r.useEffect)(()=>{c()},[c]);let x=(0,r.useCallback)(async(e={})=>{try{let a=localStorage.getItem("token"),t={headers:{Authorization:`Bearer ${a}`}},s=await l.default.get(`${i}/analytics/revenue`,{...t,params:e});return s.data.data}catch(e){throw console.error("Revenue stats error:",e),e}},[]),h=(0,r.useCallback)(async(e={})=>{try{let a=localStorage.getItem("token"),t={headers:{Authorization:`Bearer ${a}`}},s=await l.default.get(`${i}/analytics/conversion`,{...t,params:e});return s.data.data}catch(e){throw console.error("Conversion stats error:",e),e}},[]),m=(0,r.useCallback)(async(e={})=>{try{let a=localStorage.getItem("token"),t={headers:{Authorization:`Bearer ${a}`}},s=await l.default.get(`${i}/analytics/customers`,{...t,params:e});return s.data.data}catch(e){throw console.error("Customer analytics error:",e),e}},[]),u=(0,r.useCallback)(async(e={})=>{try{let a=localStorage.getItem("token"),t={headers:{Authorization:`Bearer ${a}`}},s=await l.default.get(`${i}/analytics/churn`,{...t,params:e});return s.data.data}catch(e){throw console.error("Churn analytics error:",e),e}},[]),g=(0,r.useCallback)(async(e={})=>{try{let a=localStorage.getItem("token"),t={headers:{Authorization:`Bearer ${a}`}},s=await l.default.get(`${i}/analytics/bookings`,{...t,params:e});return s.data.data}catch(e){throw console.error("Booking stats error:",e),e}},[]),p=(0,r.useCallback)(async(a="pdf",t={})=>{try{let s=localStorage.getItem("token"),r={headers:{Authorization:`Bearer ${s}`},responseType:"blob"},n=await l.default.post(`${i}/analytics/export`,{format:a,dateRange:e,...t},r),o=window.URL.createObjectURL(new Blob([n.data])),d=document.createElement("a");d.href=o,d.setAttribute("download",`analytics-${new Date().toISOString().split("T")[0]}.${a}`),document.body.appendChild(d),d.click(),d.parentElement.removeChild(d)}catch(e){throw console.error("Export error:",e),e}},[e]);return{data:a,loading:s,error:o,refetch:c,fetchRevenueStats:x,fetchConversionStats:h,fetchCustomerAnalytics:m,fetchChurnAnalytics:u,fetchBookingStats:g,exportReport:p}};s()}catch(e){s(e)}})},1133:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.r(a),t.d(a,{default:()=>AdminAnalytics,getServerSideProps:()=>getServerSideProps});var r=t(6689),l=t(968),n=t.n(l),i=t(1163),o=t(353),d=t(7077),c=t(997),x=e([d]);function AdminAnalytics(){let e=(0,i.useRouter)(),[a,t]=(0,r.useState)("30days"),[s,l]=(0,r.useState)("pdf"),[x,h]=(0,r.useState)(!1),{data:m,loading:u,error:g,refetch:p,exportReport:j}=(0,d.Z)(a);(0,r.useEffect)(()=>{t(e.query.range||"30days")},[e.query.range]);let handleExport=async()=>{try{h(!0),await j(s,{dateRange:a})}catch(e){console.error("Export failed:",e),alert("Falha ao exporting relat\xf3rio")}finally{h(!1)}},handleDateRangeChange=a=>{t(a),e.push(`/admin/analytics?range=${a}`,void 0,{shallow:!0})};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n(),{children:[c.jsx("title",{children:"Admin Analytics Dashboard - Avante"}),c.jsx("meta",{name:"description",content:"Platform analytics and reporting dashboard"})]}),(0,c.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[c.jsx("div",{className:"bg-white shadow-md",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:(0,c.jsxs)("div",{className:"flex justify-between items-center",children:[(0,c.jsxs)("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Analytics Dashboard"}),c.jsx("p",{className:"text-gray-600 mt-1",children:"Comprehensive platform metrics and insights"})]}),c.jsx("button",{onClick:()=>{p()},disabled:u,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:u?"Carregando...":"Atualizar"})]})})}),(0,c.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[g&&(0,c.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:["Erro ao carregar analytics: ",g]}),c.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),(0,c.jsxs)("select",{value:a,onChange:e=>handleDateRangeChange(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[c.jsx("option",{value:"7days",children:"\xdaltimos 7 dias"}),c.jsx("option",{value:"30days",children:"\xdaltimos 30 dias"}),c.jsx("option",{value:"90days",children:"\xdaltimos 90 dias"}),c.jsx("option",{value:"1year",children:"\xdaltimo ano"})]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Export Format"}),(0,c.jsxs)("select",{value:s,onChange:e=>l(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[c.jsx("option",{value:"pdf",children:"PDF"}),c.jsx("option",{value:"csv",children:"CSV"}),c.jsx("option",{value:"xlsx",children:"Excel (XLSX)"}),c.jsx("option",{value:"json",children:"JSON"})]})]}),c.jsx("div",{className:"flex items-end",children:c.jsx("button",{onClick:handleExport,disabled:x||u,className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-medium",children:x?"Exportando...":`Export ${s.toUpperCase()}`})})]})}),c.jsx(o.BT,{data:m,loading:u,error:g})]})]}),c.jsx("style",{jsx:!0,children:`
        @media (max-width: 768px) {
          .grid {
            grid-template-columns: 1fr;
          }
        }
      `})]})}async function getServerSideProps(e){try{let a=e.req.cookies.token;if(!a)return{redirect:{destination:"/login",permanent:!1}};return{props:{initialToken:a}}}catch(e){return{redirect:{destination:"/login",permanent:!1}}}}d=(x.then?(await x)():x)[0],s()}catch(e){s(e)}})},9006:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.r(a),t.d(a,{config:()=>g,default:()=>x,getServerSideProps:()=>u,getStaticPaths:()=>m,getStaticProps:()=>h,reportWebVitals:()=>p,routeModule:()=>N,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>f,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>j});var r=t(7093),l=t(5244),n=t(1323),i=t(2518),o=t(2456),d=t(1133),c=e([o,d]);[o,d]=c.then?(await c)():c;let x=(0,n.l)(d,"default"),h=(0,n.l)(d,"getStaticProps"),m=(0,n.l)(d,"getStaticPaths"),u=(0,n.l)(d,"getServerSideProps"),g=(0,n.l)(d,"config"),p=(0,n.l)(d,"reportWebVitals"),j=(0,n.l)(d,"unstable_getStaticProps"),b=(0,n.l)(d,"unstable_getStaticPaths"),v=(0,n.l)(d,"unstable_getStaticParams"),y=(0,n.l)(d,"unstable_getServerProps"),f=(0,n.l)(d,"unstable_getServerSideProps"),N=new r.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/admin/analytics-dashboard",pathname:"/admin/analytics-dashboard",bundlePath:"",filename:""},components:{App:o.default,Document:i.default},userland:d});s()}catch(e){s(e)}})},5427:e=>{e.exports=require("@sentry/react")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},3655:e=>{e.exports=require("recharts")},467:e=>{e.exports=import("@heroicons/react/24/outline")},291:e=>{e.exports=import("@heroicons/react/24/solid")},9648:e=>{e.exports=import("axios")},6197:e=>{e.exports=import("framer-motion")},1070:e=>{e.exports=import("react-confetti")},6201:e=>{e.exports=import("react-hot-toast")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var a=require("../../webpack-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[668,16,859,450,456,518],()=>__webpack_exec__(9006));module.exports=t})();