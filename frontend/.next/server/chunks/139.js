"use strict";exports.id=139,exports.ids=[139],exports.modules={139:(e,r,t)=>{t.r(r),t.d(r,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var i=t(6689),a=t(3988),s=t(997);let __WEBPACK_DEFAULT_EXPORT__=function(){let[e,r]=(0,i.useState)(!1),[t,n]=(0,i.useState)(!1),{addToast:o}=(0,a.p)();(0,i.useEffect)(()=>{r("serviceWorker"in navigator&&"PushManager"in window),checkSubscription()},[]);let checkSubscription=async()=>{if("serviceWorker"in navigator)try{let e=await navigator.serviceWorker.getRegistration();if(!e)return n(!1);let r=await e.pushManager.getSubscription();n(!!r)}catch(e){console.error(e)}},registerAndSubscribe=async()=>{if(!e)return o("Push n\xe3o suportado neste navegador","error");try{let e;let r=await navigator.serviceWorker.register("/sw.js");o("Service worker registrado","success");let t=await Notification.requestPermission();if("granted"!==t){o("Permiss\xe3o de notifica\xe7\xf5es negada","warning");return}let i=process.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY;e=i?await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){let r="=".repeat((4-e.length%4)%4),t=(e+r).replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(t),a=new Uint8Array(i.length);for(let e=0;e<i.length;++e)a[e]=i.charCodeAt(e);return a}(i)}):await r.pushManager.subscribe({userVisibleOnly:!0});try{await fetch((process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001")+"/api/notifications/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"})}catch(e){console.warn("N\xe3o foi poss\xedvel enviar subscription ao backend (ok no dev)",e)}n(!0),o("Inscrito para notifica\xe7\xf5es","success")}catch(e){console.error("Erro ao registrar/inscrever push:",e),o("Erro ao ativar notifica\xe7\xf5es","error")}},unsubscribe=async()=>{try{let e=await navigator.serviceWorker.getRegistration();if(!e)return;let r=await e.pushManager.getSubscription();if(r){await r.unsubscribe();try{await fetch((process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001")+"/api/notifications/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:r.endpoint}),credentials:"include"})}catch(e){}}n(!1),o("Cancelado registro de notifica\xe7\xf5es","info")}catch(e){console.error(e),o("Erro ao cancelar inscri\xe7\xe3o","error")}};return e?(0,s.jsxs)("div",{className:"p-4 bg-white rounded shadow",children:[s.jsx("h4",{className:"font-semibold mb-2",children:"Notifica\xe7\xf5es"}),s.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Ative notifica\xe7\xf5es para receber atualiza\xe7\xf5es e lembretes."}),s.jsx("div",{className:"flex gap-2",children:t?s.jsx("button",{onClick:unsubscribe,className:"px-4 py-2 bg-gray-200 rounded",children:"Desativar"}):s.jsx("button",{onClick:registerAndSubscribe,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Ativar"})})]}):s.jsx("div",{className:"p-3 text-sm text-gray-500",children:"Notifica\xe7\xf5es push n\xe3o suportadas neste navegador."})}}};