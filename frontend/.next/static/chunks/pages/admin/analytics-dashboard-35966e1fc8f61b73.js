(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[385],{75692:function(e,a,s){"use strict";s.r(a),s.d(a,{__N_SSP:function(){return R},default:function(){return AdminAnalytics}});var t=s(67294),r=s(9008),l=s.n(r),n=s(11163),d=s(29557),i=s(98687),o=s(14195),c=s(3023),h=s(75358),x=s(76224),m=s(41700),u=s(41408),g=s(94831),j=s(24666),p=s(82876),b=s(91045),y=s(43815),v=s(57478),f=s(90386),N=s(36763),w=s(86434),k=s(85893);let RevenueChart=({data:e})=>(0,k.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,k.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Revenue Trend"}),(0,k.jsx)(d.h,{width:"100%",height:300,children:(0,k.jsxs)(i.w,{data:e,children:[(0,k.jsx)(o.q,{strokeDasharray:"3 3"}),(0,k.jsx)(c.K,{dataKey:"date"}),(0,k.jsx)(h.B,{}),(0,k.jsx)(x.u,{formatter:e=>`R$ ${e.toLocaleString("pt-BR")}`}),(0,k.jsx)(m.D,{}),(0,k.jsx)(u.x1,{type:"monotone",dataKey:"revenue",stroke:"#3b82f6",strokeWidth:2,name:"Receita"}),(0,k.jsx)(u.x1,{type:"monotone",dataKey:"expenses",stroke:"#ef4444",strokeWidth:2,name:"Despesas"}),(0,k.jsx)(u.x1,{type:"monotone",dataKey:"profit",stroke:"#10b981",strokeWidth:2,name:"Lucro"})]})})]}),BookingTrendsChart=({data:e})=>(0,k.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,k.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Booking Trends"}),(0,k.jsx)(d.h,{width:"100%",height:300,children:(0,k.jsxs)(g.v,{data:e,children:[(0,k.jsx)(o.q,{strokeDasharray:"3 3"}),(0,k.jsx)(c.K,{dataKey:"date"}),(0,k.jsx)(h.B,{}),(0,k.jsx)(x.u,{}),(0,k.jsx)(m.D,{}),(0,k.jsx)(j.$Q,{dataKey:"bookings",fill:"#3b82f6",name:"Agendamentos"}),(0,k.jsx)(j.$Q,{dataKey:"completed",fill:"#10b981",name:"Completados"}),(0,k.jsx)(j.$Q,{dataKey:"cancelled",fill:"#ef4444",name:"Cancelados"})]})})]}),ConversionFunnelChart=({data:e})=>{let a=[{name:"Visitantes",value:e.visitors||1e3},{name:"Clientes Ativos",value:e.activeCustomers||750},{name:"Com Agendamentos",value:e.bookingsCreated||500},{name:"Pagamentos Processados",value:e.paymentsProcessed||400},{name:"Avalia\xe7\xf5es Deixadas",value:e.reviewsLeft||200}];return(0,k.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,k.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Funnel de Convers\xe3o"}),(0,k.jsx)(d.h,{width:"100%",height:300,children:(0,k.jsxs)(p.G,{children:[(0,k.jsx)(x.u,{formatter:e=>`${e} usu\xe1rios`}),(0,k.jsx)(b.oe,{data:a,dataKey:"value",stroke:"#3b82f6",fill:"#3b82f6",children:a.map((e,a)=>(0,k.jsx)(y.b,{fill:["#3b82f6","#60a5fa","#93c5fd","#dbeafe","#eff6ff"][a]},`cell-${a}`))})]})}),(0,k.jsx)("div",{className:"mt-4 text-sm text-gray-600",children:a.map((e,s)=>(0,k.jsxs)("div",{className:"flex justify-between",children:[(0,k.jsx)("span",{children:e.name}),(0,k.jsx)("span",{className:"font-bold",children:e.value}),s>0&&(0,k.jsxs)("span",{className:"text-blue-600",children:[(e.value/a[0].value*100).toFixed(1),"%"]})]},s))})]})},CLVDistributionChart=({data:e})=>(0,k.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,k.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Customer Lifetime Value"}),(0,k.jsx)(d.h,{width:"100%",height:300,children:(0,k.jsxs)(v.G,{margin:{top:20,right:20,bottom:20,left:20},children:[(0,k.jsx)(o.q,{strokeDasharray:"3 3"}),(0,k.jsx)(c.K,{dataKey:"bookings",name:"Agendamentos"}),(0,k.jsx)(h.B,{dataKey:"ltv",name:"LTV (R$)"}),(0,k.jsx)(x.u,{cursor:{strokeDasharray:"3 3"}}),(0,k.jsx)(f.bp,{name:"Clientes",data:e,fill:"#3b82f6"})]})})]}),CustomerSegmentationChart=({data:e})=>{let a=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"];return(0,k.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,k.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Customer Segmentation"}),(0,k.jsx)(d.h,{width:"100%",height:300,children:(0,k.jsxs)(N.u,{children:[(0,k.jsx)(w.by,{data:e,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:a})=>`${e}: ${a}`,outerRadius:100,fill:"#3b82f6",dataKey:"value",children:e.map((e,s)=>(0,k.jsx)(y.b,{fill:a[s%a.length]},`cell-${s}`))}),(0,k.jsx)(x.u,{formatter:e=>`${e} clientes`})]})}),(0,k.jsx)("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:e.map((e,s)=>(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:a[s%a.length]}}),(0,k.jsxs)("span",{children:[e.name,": ",e.value]})]},s))})]})},ChurnRiskHeatmap=({data:e})=>(0,k.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,k.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Churn Risk Analysis"}),(0,k.jsx)("div",{className:"overflow-x-auto",children:(0,k.jsxs)("table",{className:"w-full text-sm",children:[(0,k.jsx)("thead",{className:"bg-gray-100",children:(0,k.jsxs)("tr",{children:[(0,k.jsx)("th",{className:"p-2 text-left",children:"Metric"}),(0,k.jsx)("th",{className:"p-2 text-center",children:"Status"}),(0,k.jsx)("th",{className:"p-2 text-right",children:"Value"}),(0,k.jsx)("th",{className:"p-2 text-left",children:"Risk"})]})}),(0,k.jsx)("tbody",{children:e.map((e,a)=>{let s="bg-green-100",t="Baixo";return e.risk>70?(s="bg-red-100",t="Alto"):e.risk>40&&(s="bg-yellow-100",t="M\xe9dio"),(0,k.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,k.jsx)("td",{className:"p-2",children:e.metric}),(0,k.jsx)("td",{className:"p-2 text-center",children:(0,k.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,k.jsx)("div",{className:`h-2 rounded-full ${e.risk>70?"bg-red-500":e.risk>40?"bg-yellow-500":"bg-green-500"}`,style:{width:`${e.risk}%`}})})}),(0,k.jsx)("td",{className:"p-2 text-right font-bold",children:e.value}),(0,k.jsx)("td",{className:`p-2 font-bold ${s}`,children:t})]},a)})})]})})]}),AnalyticsDashboard=({data:e,loading:a,error:s})=>{let[r,l]=(0,t.useState)("30days"),[n,d]=(0,t.useState)(["revenue","bookings","conversion"]);return a?(0,k.jsx)("div",{className:"p-8 text-center",children:"Carregando analytics..."}):s?(0,k.jsxs)("div",{className:"p-8 text-center text-red-600",children:["Erro ao carregar dados: ",s]}):(0,k.jsxs)("div",{className:"space-y-6",children:[(0,k.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:(0,k.jsxs)("div",{className:"flex justify-between items-center",children:[(0,k.jsx)("h2",{className:"text-2xl font-bold",children:"Analytics Dashboard"}),(0,k.jsxs)("select",{value:r,onChange:e=>l(e.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,k.jsx)("option",{value:"7days",children:"\xdaltimos 7 dias"}),(0,k.jsx)("option",{value:"30days",children:"\xdaltimos 30 dias"}),(0,k.jsx)("option",{value:"90days",children:"\xdaltimos 90 dias"}),(0,k.jsx)("option",{value:"1year",children:"\xdaltimo ano"}),(0,k.jsx)("option",{value:"custom",children:"Custom"})]})]})}),(0,k.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,k.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,k.jsx)("h4",{className:"text-gray-600 text-sm",children:"Total Revenue"}),(0,k.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",(e.totalRevenue||0).toLocaleString("pt-BR")]}),(0,k.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.revenueGrowth||0,"% vs period anterior"]})]}),(0,k.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,k.jsx)("h4",{className:"text-gray-600 text-sm",children:"Total Bookings"}),(0,k.jsx)("p",{className:"text-2xl font-bold text-green-600",children:e.totalBookings||0}),(0,k.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.bookingGrowth||0,"% vs period anterior"]})]}),(0,k.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,k.jsx)("h4",{className:"text-gray-600 text-sm",children:"Active Users"}),(0,k.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:e.activeUsers||0}),(0,k.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.userGrowth||0,"% vs period anterior"]})]}),(0,k.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg",children:[(0,k.jsx)("h4",{className:"text-gray-600 text-sm",children:"Conversion Rate"}),(0,k.jsxs)("p",{className:"text-2xl font-bold text-orange-600",children:[(e.conversionRate||0).toFixed(1),"%"]}),(0,k.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.conversionGrowth||0,"% vs period anterior"]})]})]}),(0,k.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,k.jsx)(RevenueChart,{data:e.revenueData||[]}),(0,k.jsx)(BookingTrendsChart,{data:e.bookingData||[]})]}),(0,k.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,k.jsx)(ConversionFunnelChart,{data:e.funnelData||{}}),(0,k.jsx)(CustomerSegmentationChart,{data:e.segmentationData||[]})]}),(0,k.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,k.jsx)(CLVDistributionChart,{data:e.clvData||[]}),(0,k.jsx)(ChurnRiskHeatmap,{data:e.churnData||[]})]}),(0,k.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,k.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Customize Dashboard"}),(0,k.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:["revenue","bookings","conversion","ltv","churn","engagement","payments","reviews"].map(e=>(0,k.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,k.jsx)("input",{type:"checkbox",defaultChecked:n.includes(e),onChange:a=>{a.target.checked?d([...n,e]):d(n.filter(a=>a!==e))},className:"w-4 h-4"}),(0,k.jsx)("span",{className:"text-sm capitalize",children:e})]},e))})]})]})};var C=s(87066),$=s(34155);let A=$.env.REACT_APP_API_URL||"http://localhost:5000/api";var hooks_useAnalytics=(e="30days")=>{let[a,s]=(0,t.useState)(null),[r,l]=(0,t.useState)(!0),[n,d]=(0,t.useState)(null),i=(0,t.useCallback)(async()=>{try{l(!0),d(null);let a=localStorage.getItem("token"),t={headers:{Authorization:`Bearer ${a}`}},r=await C.Z.get(`${A}/analytics/dashboard?dateRange=${e}`,t);s(r.data.data)}catch(e){d(e.response?.data?.error||"Failed to fetch analytics"),console.error("Analytics error:",e)}finally{l(!1)}},[e]);(0,t.useEffect)(()=>{i()},[i]);let o=(0,t.useCallback)(async(e={})=>{try{let a=localStorage.getItem("token"),s={headers:{Authorization:`Bearer ${a}`}},t=await C.Z.get(`${A}/analytics/revenue`,{...s,params:e});return t.data.data}catch(e){throw console.error("Revenue stats error:",e),e}},[]),c=(0,t.useCallback)(async(e={})=>{try{let a=localStorage.getItem("token"),s={headers:{Authorization:`Bearer ${a}`}},t=await C.Z.get(`${A}/analytics/conversion`,{...s,params:e});return t.data.data}catch(e){throw console.error("Conversion stats error:",e),e}},[]),h=(0,t.useCallback)(async(e={})=>{try{let a=localStorage.getItem("token"),s={headers:{Authorization:`Bearer ${a}`}},t=await C.Z.get(`${A}/analytics/customers`,{...s,params:e});return t.data.data}catch(e){throw console.error("Customer analytics error:",e),e}},[]),x=(0,t.useCallback)(async(e={})=>{try{let a=localStorage.getItem("token"),s={headers:{Authorization:`Bearer ${a}`}},t=await C.Z.get(`${A}/analytics/churn`,{...s,params:e});return t.data.data}catch(e){throw console.error("Churn analytics error:",e),e}},[]),m=(0,t.useCallback)(async(e={})=>{try{let a=localStorage.getItem("token"),s={headers:{Authorization:`Bearer ${a}`}},t=await C.Z.get(`${A}/analytics/bookings`,{...s,params:e});return t.data.data}catch(e){throw console.error("Booking stats error:",e),e}},[]),u=(0,t.useCallback)(async(a="pdf",s={})=>{try{let t=localStorage.getItem("token"),r={headers:{Authorization:`Bearer ${t}`},responseType:"blob"},l=await C.Z.post(`${A}/analytics/export`,{format:a,dateRange:e,...s},r),n=window.URL.createObjectURL(new Blob([l.data])),d=document.createElement("a");d.href=n,d.setAttribute("download",`analytics-${new Date().toISOString().split("T")[0]}.${a}`),document.body.appendChild(d),d.click(),d.parentElement.removeChild(d)}catch(e){throw console.error("Export error:",e),e}},[e]);return{data:a,loading:r,error:n,refetch:i,fetchRevenueStats:o,fetchConversionStats:c,fetchCustomerAnalytics:h,fetchChurnAnalytics:x,fetchBookingStats:m,exportReport:u}},R=!0;function AdminAnalytics(){let e=(0,n.useRouter)(),[a,s]=(0,t.useState)("30days"),[r,d]=(0,t.useState)("pdf"),[i,o]=(0,t.useState)(!1),{data:c,loading:h,error:x,refetch:m,exportReport:u}=hooks_useAnalytics(a);(0,t.useEffect)(()=>{s(e.query.range||"30days")},[e.query.range]);let handleExport=async()=>{try{o(!0),await u(r,{dateRange:a})}catch(e){console.error("Export failed:",e),alert("Falha ao exporting relat\xf3rio")}finally{o(!1)}},handleDateRangeChange=a=>{s(a),e.push(`/admin/analytics?range=${a}`,void 0,{shallow:!0})};return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(l(),{children:[(0,k.jsx)("title",{children:"Admin Analytics Dashboard - Avante"}),(0,k.jsx)("meta",{name:"description",content:"Platform analytics and reporting dashboard"})]}),(0,k.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,k.jsx)("div",{className:"bg-white shadow-md",children:(0,k.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:(0,k.jsxs)("div",{className:"flex justify-between items-center",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Analytics Dashboard"}),(0,k.jsx)("p",{className:"text-gray-600 mt-1",children:"Comprehensive platform metrics and insights"})]}),(0,k.jsx)("button",{onClick:()=>{m()},disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:h?"Carregando...":"Atualizar"})]})})}),(0,k.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[x&&(0,k.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:["Erro ao carregar analytics: ",x]}),(0,k.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:(0,k.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),(0,k.jsxs)("select",{value:a,onChange:e=>handleDateRangeChange(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,k.jsx)("option",{value:"7days",children:"\xdaltimos 7 dias"}),(0,k.jsx)("option",{value:"30days",children:"\xdaltimos 30 dias"}),(0,k.jsx)("option",{value:"90days",children:"\xdaltimos 90 dias"}),(0,k.jsx)("option",{value:"1year",children:"\xdaltimo ano"})]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Export Format"}),(0,k.jsxs)("select",{value:r,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,k.jsx)("option",{value:"pdf",children:"PDF"}),(0,k.jsx)("option",{value:"csv",children:"CSV"}),(0,k.jsx)("option",{value:"xlsx",children:"Excel (XLSX)"}),(0,k.jsx)("option",{value:"json",children:"JSON"})]})]}),(0,k.jsx)("div",{className:"flex items-end",children:(0,k.jsx)("button",{onClick:handleExport,disabled:i||h,className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-medium",children:i?"Exportando...":`Export ${r.toUpperCase()}`})})]})}),(0,k.jsx)(AnalyticsDashboard,{data:c,loading:h,error:x})]})]}),(0,k.jsx)("style",{jsx:!0,children:`
        @media (max-width: 768px) {
          .grid {
            grid-template-columns: 1fr;
          }
        }
      `})]})}},81209:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/analytics-dashboard",function(){return s(75692)}])}},function(e){e.O(0,[216,774,336,888,179],function(){return e(e.s=81209)}),_N_E=e.O()}]);