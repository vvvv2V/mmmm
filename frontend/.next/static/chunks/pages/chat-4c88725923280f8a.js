(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{4481:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Chat}});var s=a(67294),r=a(97421),n=a(90835),i=a(43988),o=a(85893),l=a(34155),Common_ChatComponent=function({bookingId:e,userId:t,userName:a="Voc\xea"}){let[r,n]=(0,s.useState)([]),[d,c]=(0,s.useState)(""),[m,x]=(0,s.useState)(!0),[h,u]=(0,s.useState)(!1),[g,f]=(0,s.useState)("online"),b=(0,s.useRef)(null),{addToast:p}=(0,i.p)(),scrollToBottom=()=>{b.current?.scrollIntoView({behavior:"smooth"})};(0,s.useEffect)(()=>{scrollToBottom()},[r]),(0,s.useEffect)(()=>{let fetchMessages=async()=>{try{let t=l.env.NEXT_PUBLIC_API_URL||"http://localhost:3001",a=await fetch(`${t}/api/chat/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`},credentials:"include"});if(!a.ok)throw Error("Falha ao carregar mensagens");let s=await a.json();n(s.messages||generateMockMessages()),x(!1),simulateWebSocket()}catch(e){console.error("Erro ao carregar mensagens:",e),n(generateMockMessages()),x(!1),simulateWebSocket()}};fetchMessages()},[e]);let generateMockMessages=()=>[{id:1,sender:"staff",senderName:"Ana Silva",message:"Ol\xe1! Confirmo o agendamento para amanh\xe3 \xe0s 09:00",timestamp:new Date(Date.now()-36e5),status:"lido"},{id:2,sender:"client",senderName:"Maria",message:"Perfeito! At\xe9 amanh\xe3 ent\xe3o",timestamp:new Date(Date.now()-3e6),status:"lido"},{id:3,sender:"staff",senderName:"Ana Silva",message:"Vou chegar 10 minutos mais cedo para verificar tudo",timestamp:new Date(Date.now()-24e5),status:"lido"}],simulateWebSocket=()=>{f("online")},handleSendMessage=async t=>{if(t.preventDefault(),!d.trim()){p("Mensagem vazia","warning");return}u(!0);try{let t=l.env.NEXT_PUBLIC_API_URL||"http://localhost:3001",s=await fetch(`${t}/api/chat/${e}/send`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify({message:d}),credentials:"include"});if(!s.ok)throw Error("Falha ao enviar mensagem");let i=await s.json(),o={id:i.id||Date.now(),sender:"client",senderName:a,message:d,timestamp:new Date,status:"enviado"};n([...r,o]),c(""),p("Mensagem enviada","success"),u(!1)}catch(e){console.error("Erro ao enviar:",e),p("Erro ao enviar mensagem","error"),u(!1)}},handleRemoveMessage=e=>{n(r.filter(t=>t.id!==e)),p("Mensagem removida","info")},formatTime=e=>new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),formatDate=e=>{let t=new Date,a=new Date(t);a.setDate(a.getDate()-1);let s=new Date(e);return s.toDateString()===t.toDateString()?"Hoje":s.toDateString()===a.toDateString()?"Ontem":s.toLocaleDateString("pt-BR")};return m?(0,o.jsx)("div",{className:"p-6 text-center",children:"⏳ Carregando chat..."}):(0,o.jsxs)("div",{className:"flex flex-col h-screen bg-white rounded-lg shadow-lg overflow-hidden max-h-96",children:[(0,o.jsx)("div",{className:"p-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl",children:"\uD83D\uDCAC"}),(0,o.jsx)("div",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full ${"online"===g?"bg-green-400":"bg-gray-400"}`})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-semibold",children:"Chat - Agendamento"}),(0,o.jsx)("p",{className:"text-xs text-blue-100",children:"online"===g?"\uD83D\uDFE2 Online":"⚪ Offline"})]})]}),(0,o.jsx)("button",{className:"text-white hover:bg-white/20 p-2 rounded transition",children:"⋮"})]})}),(0,o.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[r.map((e,t)=>{let a=0===t||formatDate(r[t-1].timestamp)!==formatDate(e.timestamp);return(0,o.jsxs)("div",{children:[a&&(0,o.jsxs)("div",{className:"flex items-center gap-2 my-4",children:[(0,o.jsx)("div",{className:"flex-1 border-t border-gray-300"}),(0,o.jsx)("span",{className:"text-xs text-gray-500 px-2",children:formatDate(e.timestamp)}),(0,o.jsx)("div",{className:"flex-1 border-t border-gray-300"})]}),(0,o.jsxs)("div",{className:`flex gap-2 ${"client"===e.sender?"flex-row-reverse":""}`,children:[(0,o.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white text-sm font-bold",children:e.senderName.charAt(0)}),(0,o.jsxs)("div",{className:`max-w-xs lg:max-w-md ${"client"===e.sender?"items-end":"items-start"} flex flex-col`,children:[(0,o.jsx)("p",{className:`text-xs font-semibold ${"client"===e.sender?"text-right":""}`,children:e.senderName}),(0,o.jsxs)("div",{className:`mt-1 p-3 rounded-lg text-sm ${"client"===e.sender?"bg-blue-600 text-white rounded-br-none":"bg-white border border-gray-200 text-gray-900 rounded-bl-none"} hover:shadow-md transition group relative`,children:[(0,o.jsx)("p",{className:"break-words",children:e.message}),(0,o.jsx)("button",{onClick:()=>handleRemoveMessage(e.id),className:"absolute -top-6 right-0 text-xs opacity-0 group-hover:opacity-100 transition bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"✕"})]}),(0,o.jsxs)("p",{className:`text-xs text-gray-500 mt-1 ${"client"===e.sender?"text-right":""}`,children:[formatTime(e.timestamp)," ","lido"===e.status?"✓✓":"enviado"===e.status?"✓":"⏱"]})]})]})]},e.id)}),(0,o.jsx)("div",{ref:b})]}),(0,o.jsxs)("form",{onSubmit:handleSendMessage,className:"p-4 border-t border-gray-200 bg-white",children:[(0,o.jsxs)("div",{className:"flex gap-2",children:[(0,o.jsx)("button",{type:"button",className:"flex-shrink-0 px-3 py-2 text-xl bg-gray-100 hover:bg-gray-200 rounded transition",title:"Anexar arquivo",children:"\uD83D\uDCCE"}),(0,o.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),placeholder:"Digite sua mensagem...",disabled:h,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,o.jsx)("button",{type:"submit",disabled:h||!d.trim(),className:"flex-shrink-0 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:h?"⏳":"➤"})]}),(0,o.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["\uD83D\uDCA1 Use ",(0,o.jsx)("strong",{children:"Enter"})," para enviar, ",(0,o.jsx)("strong",{children:"Shift+Enter"})," para quebra de linha"]})]})]})};function Chat(){let[e]=(0,s.useState)("booking_001");return(0,o.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,o.jsx)(r.Z,{}),(0,o.jsx)("main",{className:"flex-grow p-6 bg-gray-50",children:(0,o.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"\uD83D\uDCAC Chat do Agendamento"}),(0,o.jsx)(Common_ChatComponent,{bookingId:e,userId:"user_123",userName:"Maria Silva"})]})}),(0,o.jsx)(n.Z,{})]})}},52583:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return a(4481)}])}},function(e){e.O(0,[857,774,336,216,888,179],function(){return e(e.s=52583)}),_N_E=e.O()}]);