"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[139],{80139:function(e,r,t){t.r(r);var a=t(67294),i=t(43988),s=t(85893),n=t(34155);r.default=function(){let[e,r]=(0,a.useState)(!1),[t,o]=(0,a.useState)(!1),{addToast:c}=(0,i.p)();(0,a.useEffect)(()=>{r("serviceWorker"in navigator&&"PushManager"in window),checkSubscription()},[]);let checkSubscription=async()=>{if("serviceWorker"in navigator)try{let e=await navigator.serviceWorker.getRegistration();if(!e)return o(!1);let r=await e.pushManager.getSubscription();o(!!r)}catch(e){console.error(e)}},registerAndSubscribe=async()=>{if(!e)return c("Push n\xe3o suportado neste navegador","error");try{let e;let r=await navigator.serviceWorker.register("/sw.js");c("Service worker registrado","success");let t=await Notification.requestPermission();if("granted"!==t){c("Permiss\xe3o de notifica\xe7\xf5es negada","warning");return}let a=n.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY;e=a?await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){let r="=".repeat((4-e.length%4)%4),t=(e+r).replace(/-/g,"+").replace(/_/g,"/"),a=window.atob(t),i=new Uint8Array(a.length);for(let e=0;e<a.length;++e)i[e]=a.charCodeAt(e);return i}(a)}):await r.pushManager.subscribe({userVisibleOnly:!0});try{await fetch((n.env.NEXT_PUBLIC_API_URL||"http://localhost:3001")+"/api/notifications/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"})}catch(e){console.warn("N\xe3o foi poss\xedvel enviar subscription ao backend (ok no dev)",e)}o(!0),c("Inscrito para notifica\xe7\xf5es","success")}catch(e){console.error("Erro ao registrar/inscrever push:",e),c("Erro ao ativar notifica\xe7\xf5es","error")}},unsubscribe=async()=>{try{let e=await navigator.serviceWorker.getRegistration();if(!e)return;let r=await e.pushManager.getSubscription();if(r){await r.unsubscribe();try{await fetch((n.env.NEXT_PUBLIC_API_URL||"http://localhost:3001")+"/api/notifications/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:r.endpoint}),credentials:"include"})}catch(e){}}o(!1),c("Cancelado registro de notifica\xe7\xf5es","info")}catch(e){console.error(e),c("Erro ao cancelar inscri\xe7\xe3o","error")}};return e?(0,s.jsxs)("div",{className:"p-4 bg-white rounded shadow",children:[(0,s.jsx)("h4",{className:"font-semibold mb-2",children:"Notifica\xe7\xf5es"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Ative notifica\xe7\xf5es para receber atualiza\xe7\xf5es e lembretes."}),(0,s.jsx)("div",{className:"flex gap-2",children:t?(0,s.jsx)("button",{onClick:unsubscribe,className:"px-4 py-2 bg-gray-200 rounded",children:"Desativar"}):(0,s.jsx)("button",{onClick:registerAndSubscribe,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Ativar"})})]}):(0,s.jsx)("div",{className:"p-3 text-sm text-gray-500",children:"Notifica\xe7\xf5es push n\xe3o suportadas neste navegador."})}}}]);