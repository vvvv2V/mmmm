#!/bin/bash\n\n# üß™ TESTES DE VALIDA√á√ÉO - Corre√ß√µes Implementadas\n# ================================================\n\necho \"üîç Validando todas as corre√ß√µes implementadas...\"\necho \"\"\n\n# Cores\nGREEN='\\033[0;32m'\nRED='\\033[0;31m'\nYELLOW='\\033[1;33m'\nNC='\\033[0m'\n\ntest_count=0\npassed=0\nfailed=0\n\necho \"üìã Verificando corre√ß√µes de c√≥digo...\"\necho \"\"\n\n# Teste 1: PaymentController usa db pool\necho \"Test 1Ô∏è‚É£ : PaymentController usa db pool centralizado\"\n((test_count++))\nif grep -q \"const db = require('../db')\" backend/src/controllers/PaymentController.js; then\n    echo -e \"${GREEN}‚úì PASSED${NC}\"\n    ((passed++))\nelse\n    echo -e \"${RED}‚úó FAILED${NC} - N√£o usa db pool\"\n    ((failed++))\nfi\necho \"\"\n\n# Teste 2: Multer tem fileFilter\necho \"Test 2Ô∏è‚É£ : Multer valida√ß√£o MIME type\"\n((test_count++))\nif grep -q \"fileFilter\" backend/src/routes/api.js && grep -q \"allowedMimes\" backend/src/routes/api.js; then\n    echo -e \"${GREEN}‚úì PASSED${NC}\"\n    ((passed++))\nelse\n    echo -e \"${RED}‚úó FAILED${NC} - Multer sem valida√ß√£o\"\n    ((failed++))\nfi\necho \"\"\n\n# Teste 3: JWT secrets protegido em produ√ß√£o\necho \"Test 3Ô∏è‚É£ : JWT secrets protection em produ√ß√£o\"\n((test_count++))\nif grep -q \"process.exit(1)\" backend/src/middleware/auth.js; then\n    echo -e \"${GREEN}‚úì PASSED${NC}\"\n    ((passed++))\nelse\n    echo -e \"${RED}‚úó FAILED${NC} - Sem prote√ß√£o de secrets\"\n    ((failed++))\nfi\necho \"\"\n\n# Teste 4: AuthContext implementou login real\necho \"Test 4Ô∏è‚É£ : AuthContext.jsx - login API chamada\"\n((test_count++))\nif grep -q \"fetch.*api/auth/login\" frontend/src/context/AuthContext.jsx; then\n    echo -e \"${GREEN}‚úì PASSED${NC}\"\n    ((passed++))\nelse\n    echo -e \"${RED}‚úó FAILED${NC} - Login ainda mockado\"\n    ((failed++))\nfi\necho \"\"\n\n# Teste 5: AuthContext implementou register real\necho \"Test 5Ô∏è‚É£ : AuthContext.jsx - register API chamada\"\n((test_count++))\nif grep -q \"fetch.*api/auth/register\" frontend/src/context/AuthContext.jsx; then\n    echo -e \"${GREEN}‚úì PASSED${NC}\"\n    ((passed++))\nelse\n    echo -e \"${RED}‚úó FAILED${NC} - Register ainda mockado\"\n    ((failed++))\nfi\necho \"\"\n\n# Teste 6: CNPJ validation implementado\necho \"Test 6Ô∏è‚É£ : CNPJ validation function exists\"\n((test_count++))\nif grep -q \"function validateCNPJ\" backend/src/controllers/AuthController.js; then\n    echo -e \"${GREEN}‚úì PASSED${NC}\"\n    ((passed++))\nelse\n    echo -e \"${RED}‚úó FAILED${NC} - CNPJ validation n√£o implementado\"\n    ((failed++))\nfi\necho \"\"\n\n# Teste 7: bcrypt rounds padronizado\necho \"Test 7Ô∏è‚É£ : bcrypt rounds padronizado (12)\"\n((test_count++))\nif grep -q \"BCRYPT_ROUNDS = 12\" backend/src/controllers/AuthController.js; then\n    echo -e \"${GREEN}‚úì PASSED${NC}\"\n    ((passed++))\nelse\n    echo -e \"${RED}‚úó FAILED${NC} - bcrypt rounds inconsistente\"\n    ((failed++))\nfi\necho \"\"\n\n# Teste 8: PaymentController tem sanitiza√ß√£o\necho \"Test 8Ô∏è‚É£ : PaymentController sanitiza entrada\"\n((test_count++))\nif grep -q \"sanitizeHtml\\|replace(/\\[\\^a-zA-Z0-9\" backend/src/controllers/PaymentController.js; then\n    echo -e \"${GREEN}‚úì PASSED${NC}\"\n    ((passed++))\nelse\n    echo -e \"${RED}‚úó FAILED${NC} - Sem sanitiza√ß√£o\"\n    ((failed++))\nfi\necho \"\"\n\n# Teste 9: PaymentController tem autoriza√ß√£o\necho \"Test 9Ô∏è‚É£ : PaymentController verifica autoriza√ß√£o\"\n((test_count++))\nif grep -q \"req.user.userId !== userId\\|req.user.userId !== parseInt\" backend/src/controllers/PaymentController.js; then\n    echo -e \"${GREEN}‚úì PASSED${NC}\"\n    ((passed++))\nelse\n    echo -e \"${RED}‚úó FAILED${NC} - Sem verifica√ß√£o de autoriza√ß√£o\"\n    ((failed++))\nfi\necho \"\"\n\n# Teste 10: Melhorias sugeridas documentadas\necho \"Test üîü: Roadmap de melhorias documentado\"\n((test_count++))\nif [ -f \"MELHORIAS_SUGERIDAS.md\" ]; then\n    echo -e \"${GREEN}‚úì PASSED${NC}\"\n    ((passed++))\nelse\n    echo -e \"${RED}‚úó FAILED${NC} - Roadmap n√£o criar\"\n    ((failed++))\nfi\necho \"\"\n\necho \"===============================================\"\necho \"üìä RESULTADO FINAL\"\necho \"===============================================\"\necho -e \"Total de testes: ${test_count}\"\necho -e \"${GREEN}Passed: ${passed}${NC}\"\necho -e \"${RED}Failed: ${failed}${NC}\"\necho \"\"\n\nif [ $failed -eq 0 ]; then\n    echo -e \"${GREEN}‚úÖ TODAS AS CORRE√á√ïES VALIDADAS COM SUCESSO!${NC}\"\n    echo \"\"\n    echo \"üéØ Pr√≥ximos passos:\"\n    echo \"1. Execute: npm test (backend)\"\n    echo \"2. Execute: npm test (frontend)\"\n    echo \"3. Leia: MELHORIAS_SUGERIDAS.md para roadmap completo\"\n    exit 0\nelse\n    echo -e \"${RED}‚ùå Some tests failed. Check the output above.${NC}\"\n    exit 1\nfi\n"